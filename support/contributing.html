<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="article:modified_time" content="2024-02-29T04:33:17+00:00" /><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Algorithms" href="../reference/algorithm.html" /><link rel="prev" title="Installation" href="../installation.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>Contributing - pfl 0.3.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">pfl 0.3.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">pfl 0.3.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/fl_introduction.html">Federated learning with pfl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/simulation_distributed.html">Fast distributed simulations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/algorithm.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/aggregate.html">Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/aggregate.html#aggregator">Aggregator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/aggregate.html#module-pfl.aggregate.data_transport">Data transport</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/aggregate.html#module-pfl.aggregate.weighting">Weighting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/callback.html">Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/common_types.html">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/context.html">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/exception.html">Exception</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/hyperparam.html">Hyperparameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/model.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/postprocessor.html">Postprocessor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/privacy.html">Differential privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/stats.html">Training statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/tree.html">Gradient boosted decision trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/environment_variables.html">Environment variables</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/internal/index.html">Internal API</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Internal API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/internal/bisect.html">Bisect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/internal/bridge.html">Bridges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/internal/distribution.html">Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/internal/ops.html">Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/internal/platform.html">Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/internal/privacy_loss_bound.html">Privacy loss bound</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/internal/tree.html">Tree</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="contributing">
<span id="id1"></span><h1>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">#</a></h1>
<p>We welcome contributions from anyone who wish to improve <code class="docutils literal notranslate"><span class="pre">pfl</span></code> for research.
The framework is maintained in <a class="reference external" href="https://github.com/apple/pfl-research">pfl-research Git repository</a> and anything related to benchmarking and new research goes into <a class="reference external" href="https://github.com/apple/pfl-research">pfl-research Git repository</a>.
Below are guidelines on how to make contributions to <code class="docutils literal notranslate"><span class="pre">pfl</span></code> that follow our best practices.
See <a class="reference external" href="https://github.com/apple/pfl-research/issues">open issues</a> for community reported bugs and beginner friendly tasks.</p>
<section id="setting-up-development-environment">
<h2>Setting up development environment<a class="headerlink" href="#setting-up-development-environment" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">main</span></code> branch always contains the latest release of <code class="docutils literal notranslate"><span class="pre">pfl</span></code>.
Any new features and improvements should be based off the development branch called <code class="docutils literal notranslate"><span class="pre">develop</span></code>.
If you would like to contribute to <code class="docutils literal notranslate"><span class="pre">pfl</span></code>, a first step is to set up your development environment by following these steps:</p>
<ol class="arabic simple">
<li><p>Create a fork of <code class="docutils literal notranslate"><span class="pre">pfl-research</span></code> repo using the github UI: go to <a class="reference external" href="https://github.com/apple/pfl-research">pfl-research Git repository</a> and click on <code class="docutils literal notranslate"><span class="pre">Fork</span></code>. <strong>Do not keep your branches in the main pfl-research repo</strong>.</p></li>
<li><p>Clone the forked repository to your local computer.</p></li>
<li><p>Execute these commands:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add apple/pfl-research as an upstream</span>
git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>upstream<span class="w"> </span>https://github.com/apple/pfl-research
git<span class="w"> </span>fetch<span class="w"> </span>upstream

<span class="c1"># Checkout a new feature branch, called &#39;new-awesome-feature&#39;, based off &quot;develop&quot; from upstream</span>
git<span class="w"> </span>checkout<span class="w"> </span>upstream/develop<span class="w"> </span>-b<span class="w"> </span>new-awesome-feature
</pre></div>
</div>
<p>Prerequisite - you need to have <a class="reference external" href="https://python-poetry.org">Poetry</a> installed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-sSL<span class="w"> </span>https://install.python-poetry.org<span class="w"> </span><span class="p">|</span><span class="w"> </span>python3<span class="w"> </span>-
</pre></div>
</div>
<p>Prerequisite - if you don’t have the correct Python version installed which is constrainted in <a class="reference external" href="https://github.com/apple/pfl-research/blob/main/pyproject.toml">pyproject.toml</a>, install it with conda. You only need to have this activated the first time you install the poetry environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>py310<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.10
conda<span class="w"> </span>activate<span class="w"> </span>py310
</pre></div>
</div>
<p>Install environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you have the new Python 3.10 environment active, it should be cloned.</span>
poetry<span class="w"> </span>env<span class="w"> </span>use<span class="w"> </span><span class="sb">`</span>which<span class="w"> </span>python<span class="sb">`</span>
<span class="c1"># Install with whatever extras and dev groups you need for development.</span>
poetry<span class="w"> </span>install<span class="w"> </span>-E<span class="w"> </span>pytorch<span class="w"> </span>-E<span class="w"> </span>tf<span class="w"> </span>-E<span class="w"> </span>trees<span class="w"> </span>--with<span class="w"> </span>dev,docs
<span class="c1"># Activate environment</span>
poetry<span class="w"> </span>shell
</pre></div>
</div>
<p>This will install <code class="docutils literal notranslate"><span class="pre">pfl</span></code> in a reproducible environment identical to everybody working on <code class="docutils literal notranslate"><span class="pre">pfl</span></code>, including our CI build pipelines.</p>
</section>
<section id="compiling-the-documentation">
<h2>Compiling the documentation<a class="headerlink" href="#compiling-the-documentation" title="Link to this heading">#</a></h2>
<p>If you have improvements for the documentation, or if you add things that require a change in the documentation, we look forward to finding this in a pull request to the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch.</p>
<p>The documentation is built with Sphinx.
To build the documentation, you need to install <code class="docutils literal notranslate"><span class="pre">pfl</span></code> at minimum with the <code class="docutils literal notranslate"><span class="pre">docs</span></code> dependency group:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>install<span class="w"> </span>--only<span class="w"> </span>docs
</pre></div>
</div>
<p>Once all required packages are installed, building is easy:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>docs
</pre></div>
</div>
<p>Or use the underlying poetry command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>make<span class="w"> </span>-C<span class="w"> </span>docs<span class="w"> </span>html
</pre></div>
</div>
<p>Any PR that adds a public interface should have a docstring with <a class="reference external" href="https://sphinx-rtd-tutorial.readthedocs.io/en/latest/docstrings.html">Sphinx-style docstring formatting</a> and be imported into the reference documentation at <code class="docutils literal notranslate"><span class="pre">doc/source/reference</span></code>.</p>
</section>
<section id="contributing-to-code">
<h2>Contributing to code<a class="headerlink" href="#contributing-to-code" title="Link to this heading">#</a></h2>
<section id="development-process">
<h3>Development process<a class="headerlink" href="#development-process" title="Link to this heading">#</a></h3>
<p>We have a few rules with regards to the process of developing a new feature in <code class="docutils literal notranslate"><span class="pre">pfl</span></code>.
We follow <a class="reference external" href="https://semver.org/">semantic versioning</a>.
This means that we do not accept any new changes into pfl’s current major version that cause a breaking change to the public API.
See <a class="reference internal" href="#code-structure"><span class="std std-ref">code structure</span></a> for information about what parts of <code class="docutils literal notranslate"><span class="pre">pfl</span></code> are classified as public API.</p>
<p>We don’t have an RFC process in place yet for external contributions.
If you wish to implement a new feature that will require at least a minor version bump according to semantic versioning we suggest that you first open an <a class="reference external" href="https://github.com/apple/pfl-research/issues">issue</a> and explain the why, what and how and get some initial feedback.</p>
<p>There are 2 active branches in the main repository (and 1 additional when preparing to release):</p>
<ul class="simple">
<li><p><strong>main</strong> - This is the current released version of <code class="docutils literal notranslate"><span class="pre">pfl</span></code>, which is also available on PyPI. The only branches that should be merged into this branch are release branches.</p></li>
<li><p><strong>develop</strong> - This is the working branch to base from when developing a new feature and PRs should be directed toward this branch as long as they are compatible with the current major version of <code class="docutils literal notranslate"><span class="pre">pfl</span></code>.</p></li>
<li><p><strong>release-x.y.z</strong> - These branches are made when we prepare for a release, and are merge commited into <em>main</em>.</p></li>
</ul>
<p>Feature PRs merged into <strong>develop</strong> and <strong>release-x.y.z</strong> should be squash merged.
Merging <strong>release-x.y.z → main and main → develop</strong> should be regular merge commits such that the history is kept.</p>
</section>
<section id="standardizing-the-code">
<h3>Standardizing the code<a class="headerlink" href="#standardizing-the-code" title="Link to this heading">#</a></h3>
<p>We like to keep the quality of the code high and reduce the ambiguity in how it should be formatted.
For that, we use <a class="reference external" href="https://github.com/google/yapf">yapf</a>, <a class="reference external" href="https://docs.astral.sh/ruff/">ruff</a>  and <a class="reference external" href="https://mypy-lang.org/">mypy</a>.</p>
<p>Following <a class="reference external" href="https://google.github.io/styleguide/pyguide.html">Google’s Python styleguide</a> is preferred, but it is acceptable to deviate from it on your own discretion because we do not strictly require it.
Unlike Google’s styleguide, we use <a class="reference external" href="https://sphinx-rtd-tutorial.readthedocs.io/en/latest/docstrings.html">Sphinx-style docstring formatting</a>.
Do not include <cite>:type</cite> and <cite>:rtype</cite>, since that is replaced by type hints.
For consistency, code should be formatted with <a class="reference external" href="https://github.com/google/yapf">yapf</a> of the version specified in <a class="reference external" href="https://github.com/apple/pfl-research/blob/main/pyproject.toml">pyproject.toml</a>.
<a class="reference external" href="https://github.com/google/yapf">yapf</a> automates a subset of the rules mentioned in the styleguide.
To run <a class="reference external" href="https://github.com/google/yapf">yapf</a>, integrate it in your IDE or manually run the following command in the root directory of <code class="docutils literal notranslate"><span class="pre">pfl-research</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>yapf
</pre></div>
</div>
<p>Or use the underlying poetry command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>yapf<span class="w"> </span>-i<span class="w"> </span>--recursive<span class="w"> </span>--parallel<span class="w"> </span>pfl/<span class="w"> </span>tests/
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pfl</span></code> uses <a class="reference external" href="https://docs.python.org/3.7/library/typing.html">type hints</a> to ensure the design is coherent and to provide valuable documentation about parameters of interfaces.
We use <a class="reference external" href="https://mypy-lang.org/">mypy</a> for the type checking itself.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>mypy
</pre></div>
</div>
<p>We also use <a class="reference external" href="https://docs.astral.sh/ruff/">ruff</a> for consistency.
The settings to use for linting <code class="docutils literal notranslate"><span class="pre">pfl</span></code> is included in <a class="reference external" href="https://github.com/apple/pfl-research/blob/main/pyproject.toml">pyproject.toml</a> in the root directory.</p>
<p>You can integrate <a class="reference external" href="https://docs.astral.sh/ruff/">ruff</a> with your IDE or manually run the following command to check for linting issues in all of <code class="docutils literal notranslate"><span class="pre">pfl</span></code> and perform type checking.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>ruff<span class="w"> </span>check<span class="w"> </span>--diff<span class="w"> </span>pfl/<span class="w"> </span>tests/
</pre></div>
</div>
<p>In summary, the checks your branch needs to pass to be able to contribute the changes are <a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a>, <a class="reference external" href="https://github.com/google/yapf">yapf</a>, <a class="reference external" href="https://mypy-lang.org/">mypy</a>, <a class="reference external" href="https://docs.astral.sh/ruff/">ruff</a> and successfully compiling the documentation.
Don’t worry if you might have missed any of these, there is a CI build pipeline for each check that will run when you submit your PR.</p>
</section>
<section id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h3>
<p>We like making sure that your code works and keeps working even if we make changes.
Therefore, we have unit tests for anything that is reasonably unit-testable.
To be merged, the code in the pull request should pass all tests.
To run all tests locally, install <a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a> and run it in the root dir:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>Or use the underlying poetry command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>-svx
</pre></div>
</div>
<p>To test all different environments <code class="docutils literal notranslate"><span class="pre">pfl</span></code> is expected to be compatible with,
install <a class="reference external" href="https://tox.readthedocs.io/en/latest/">tox</a> and run <code class="docutils literal notranslate"><span class="pre">tox</span></code> in the root dir.</p>
<p>Tests are all located in the <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory.
Larger functional/integration tests are located in <code class="docutils literal notranslate"><span class="pre">tests/integration</span></code> and are currently only required for features related to multi-worker and multi-process simulations.
New unit tests should be placed in a file in <code class="docutils literal notranslate"><span class="pre">tests</span></code> which mirrors the path of the feature in the <code class="docutils literal notranslate"><span class="pre">pfl</span></code> module.
The class and method names should also be mirrored. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pfl/model/my_model.py</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ... implementation</span>

<span class="c1"># tests/model/test_my_model.py</span>
<span class="k">class</span> <span class="nc">TestMyModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ... test implementation</span>
</pre></div>
</div>
<p>Try to re-use existing mocked components from the <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files before you decide to create a new mocked component.</p>
<p>If your test will only be able to run on MacOS (currently, CI build pipelines to not support MacOS), use the decorator <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.macos</span></code>.
The test will then only be enabled when run with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>--macos
</pre></div>
</div>
</section>
<section id="package-dependencies">
<h3>Package dependencies<a class="headerlink" href="#package-dependencies" title="Link to this heading">#</a></h3>
<p>It is not trivial to manage a package which supports use-cases using TF, PyTorch or none of these packages.
We keep dependencies of different deep learning frameworks separate with install extras, see <a class="reference external" href="https://github.com/apple/pfl-research/blob/main/pyproject.toml">pyproject.toml</a>.
If your feature has a new dependency but it is only relevant when used in combination with a particular deep learning framework, then put the dependency in the appropriate install extra.
In <a class="reference external" href="https://github.com/apple/pfl-research/blob/main/pyproject.toml">pyproject.toml</a>, constrain the new dependency from the earliest known <strong>minor</strong> version, up to but not including the next <strong>major</strong> version.
Thereafter, update the lock file to update pinned versions for local development and CI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>lock<span class="w"> </span>--no-update
</pre></div>
</div>
<p>This will ensure both developers and CI have reproducible builds.</p>
</section>
<section id="code-structure">
<span id="id2"></span><h3>Code structure<a class="headerlink" href="#code-structure" title="Link to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When implementing components for your own research without the plan to contribute back to <code class="docutils literal notranslate"><span class="pre">pfl</span></code>, you can of course import e.g. <code class="docutils literal notranslate"><span class="pre">torch</span></code> anywhere you want and don’t have to adhere to these rules.</p>
</div>
<p>Everything in <code class="docutils literal notranslate"><span class="pre">pfl.internal</span></code> is <strong>not</strong> considered a part of the public API, everything else in the <code class="docutils literal notranslate"><span class="pre">pfl</span></code> module is.
This means that you are free to make breaking interface changes if the code is located in <code class="docutils literal notranslate"><span class="pre">pfl.internal</span></code>, but not to other components because of semantic versioning.
Users should be able to run <code class="docutils literal notranslate"><span class="pre">pfl</span></code> with 0 or 1 deep learning frameworks without the need to install all deep learning frameworks.
For this we keep the TF and PyTorch code encapsulated in a few modules, which should not be automatically imported into <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> files.
Code for each deep learning framework should be encapsulated in 1 dataset module, 1 model module, 1 ops module and 1 bridge module.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, all PyTorch code is encapsulated in:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pfl.data.pytorch</span></code> - PyTorch native dataset support</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pfl.model.pytorch</span></code> - PyTorch models</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pfl.internal.ops.pytorch_ops</span></code> - low-level PyTorch-specific operations. This module does not depend on any other components in <code class="docutils literal notranslate"><span class="pre">pfl</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pfl.internal.bridge.pytorch</span></code> - Concrete PyTorch implementations of interfaces that are used to inject framework-specific code into algorithms. <code class="docutils literal notranslate"><span class="pre">pfl</span></code> primitives such as <a class="reference internal" href="../reference/metrics.html#pfl.metrics.Metrics" title="pfl.metrics.Metrics"><code class="xref py py-class docutils literal notranslate"><span class="pre">Metrics</span></code></a> or <a class="reference internal" href="../reference/stats.html#pfl.stats.TrainingStatistics" title="pfl.stats.TrainingStatistics"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrainingStatistics</span></code></a> may be used here.</p></li>
</ul>
</div>
<p>To inject code from the particular deep learning framework currently in use, put it in the ops module if it is a single function that has no other dependencies, or make a new interface in <code class="docutils literal notranslate"><span class="pre">pfl.internal.bridge</span></code> if it is a collection of functions that belong together to make a certain feature work and is optional to implement for any one deep learning framework .</p>
<p>How to use the current selected ops module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pfl.internal.ops.selector</span> <span class="kn">import</span> <span class="n">get_default_framework_module</span> <span class="k">as</span> <span class="n">ops</span>
<span class="n">ops</span><span class="p">()</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="making-a-pull-request">
<h3>Making a pull request<a class="headerlink" href="#making-a-pull-request" title="Link to this heading">#</a></h3>
<p>Once the code is standardized and tests are implemented in the <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory, you are ready to do a pull request.
For that you just need to push the files you modified to the branch of your forked repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>add<span class="w"> </span>files-you-changed
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Message explaining your changes&#39;</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>new-awesome-feature
</pre></div>
</div>
<p>Finally, you can go do a pull request from the Github UI: go to <code class="docutils literal notranslate"><span class="pre">https://github.com/apple/pfl-research/compare</span></code> and click on <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">pull</span> <span class="pre">request</span></code>. Then, make sure that you reference any open issues that the PR solves and leave an informative message about the changes made in the <code class="docutils literal notranslate"><span class="pre">new-awesome-feature</span></code> branch.</p>
<p>The next step is to wait for the CI builds to pass (progress is shown at the bottom of the PR).
Contributors with admin status may have to kickstart the CI for you.</p>
<p><strong>Checklist for a PR to pass review</strong></p>
<p>This is a checklist for the reviewer to go through in addition to reviewing the code quality.
The contributor should take this checklist into account to ensure a smooth and quick process for getting the PR merged.</p>
<ol class="arabic simple">
<li><p>Corresponding documentation should also be updated: reference docstring and tutorials.</p></li>
<li><p>Unit tests should have good coverage: positive test (should pass), negative test (should fail), test for numerical stability if relevant, statistical test if relevant.</p></li>
<li><p>If relevant, add test case to any integration test this PR can affect (in <code class="docutils literal notranslate"><span class="pre">tests/integration</span></code>).</p></li>
<li><p>Check if <a class="reference external" href="https://github.com/apple/pfl-research">pfl-research Git repository</a> repo should be updated along with this PR.</p></li>
<li><p>Pass all PR builds (pytest, yapf, ruff, mypy, build wheel, build docs). This is run by a pfl admin on the contributor’s behalf.</p></li>
<li><p>A small description of the change is included in CHANGELOG.md if it is relevant to notify users about it.</p></li>
</ol>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../reference/algorithm.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Algorithms</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../installation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024 Apple Inc.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Feb 29, 2024</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Contributing</a><ul>
<li><a class="reference internal" href="#setting-up-development-environment">Setting up development environment</a></li>
<li><a class="reference internal" href="#compiling-the-documentation">Compiling the documentation</a></li>
<li><a class="reference internal" href="#contributing-to-code">Contributing to code</a><ul>
<li><a class="reference internal" href="#development-process">Development process</a></li>
<li><a class="reference internal" href="#standardizing-the-code">Standardizing the code</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#package-dependencies">Package dependencies</a></li>
<li><a class="reference internal" href="#code-structure">Code structure</a></li>
<li><a class="reference internal" href="#making-a-pull-request">Making a pull request</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=4621528c"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>