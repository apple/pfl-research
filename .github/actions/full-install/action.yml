name: 'Full Install'
description: 'Install dependencies using Poetry with optional extras'

inputs:
  extras:
    description: 'Space-separated list of extras to install (e.g., "tf pytorch trees")'
    required: false
    default: 'tf pytorch trees'

runs:
  using: 'composite'
  steps:
    - name: Create extras file for cache key
      shell: bash
      run: echo "${{ inputs.extras }}" > extras.txt

    - name: Install Poetry and Python
      uses: ./.github/actions/python-install

    - name: Install dependencies
      shell: bash
      env:
        # Work around Horovod/gloo on newer CMake
        CMAKE_ARGS: -DCMAKE_POLICY_VERSION_MINIMUM=3.5
      run: |
        poetry install -E "${{ inputs.extras }}" -q || true
        poetry run ./build_scripts/install_horovod.sh "${{ inputs.extras }}" true
